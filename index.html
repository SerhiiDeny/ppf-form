<script>
  window.__sendNow = function () {
    try {
      // Сбор данных (совместимо с твоим n8n)
      const basic = Array.from(document.querySelectorAll('.basic-item'))
        .find(i => i.checked)?.value || '';
      const partial = Array.from(document.querySelectorAll('.partial-item:checked'))
        .map(i => i.value);

      const payload = {
        name_client: document.getElementById('name_client')?.value || '',
        email_client: document.getElementById('email_client')?.value || '',
        phone: document.getElementById('phone')?.value || '',
        marca: document.getElementById('brand')?.value || '',
        modelo: document.getElementById('model')?.value || '',
        año: document.getElementById('year')?.value || '',
        service_basic: basic,
        service_partial: partial.join(', '),
        marca_ppf: document.getElementById('ppf')?.value || '',
        check_promotion: document.getElementById('promo')?.checked ? 'Checked' : '',
        mode: document.querySelector('input[name="mode"]:checked')?.value || 'text'
      };

      const tg = window.Telegram?.WebApp;

      if (tg) {
        // если открыто внутри Telegram WebApp — отправляем в бота
        tg.sendData(JSON.stringify(payload));
      } else {
        // если открыто как обычная страница — просто показываем, что уйдёт
        alert('Payload:\n' + JSON.stringify(payload, null, 2));
        console.log('Payload (outside Telegram):', payload);
      }
    } catch (err) {
      console.error('Ошибка при отправке:', err);
      alert('Ошибка при отправке: ' + (err?.message || err));
    }
  };
</script>
